# Image RAG 專案架構文件

## 1. 專案概述
本專案旨在建立一個基於圖像與文件的檢索增強生成 (RAG) 系統，處理企業內部的資安規範、流程程序及相關申請表單。

## 2. 目錄結構
- `Docs/`: 存放專案說明與架構文件。
- `File/`: 原始文件 (docx, pdf) 與轉換後的 Markdown (md) 檔案，以及分段後的 JSON 資料。
- `image/`: 存放相關圖檔或 OCR 原始來源。
- `script/`: 專案工具腳本。
- `log/`: 系統執行日誌。

## 3. 資料處理流程 (Data Pipeline)
1. **格式轉換 (基本)**: 
   - 使用 `convert_docx_to_md.py` 或 `convert_with_docling.py` 將原始 `.docx` 規範文件轉換為 `.md` 格式。
2. **多模態 PDF 預處理 (進階 - `script/2.py`)**:
   - **工具**: 使用 Docling 解析複雜 PDF (如 YOLO 論文)。
   - **圖片提取**: 自動識別並提取 PDF 中的圖片至 `assets/` 資料夾，命名格式為 `page_{頁碼}_img_{序號}.png`。
   - **表格處理**: 表格直接轉換為 Markdown Table 嵌入文件中，不輸出圖片，以維持文字檢索能力。
   - **VLM 描述**: 整合本地 Ollama (`granite3.2-vision:latest`)，對提取出的圖片進行中文語義描述。
   - **精準回寫**: 將圖片連結與 AI 描述精確插入至 `output.md` 的對應位置，達成圖文並茂的 RAG 基底。
3. **文本分段 (Chunking)**:
   - 使用 `chunk_md_files.py` 處理 Markdown 檔案。
   - **規範類 (IC02, IP14)**: 依據章節標題標籤 (如 `## 1`, `5.1`) 進行邏輯分段。
   - **表單類 (IC0201, IC0202)**: 保留完整結構作為單一 Chunk。
4. **關聯性建立 (Association)**:
   - 透過關鍵字偵測 (如文件編號、表單名稱) 自動建立段落間的 `associations`。
   - 確保程序文件 (IP14) 與其對應表單 (IC0201, IC0202) 具備雙向連結。
5. **輸出結果**: 
   - 最終生成 `File/chunks.json`，作為後續向量化與檢索的基礎。

## 4. 核心文件關聯地圖
- **IC02 (存取控制作業規範)**: 頂層政策。
- **IP14 (帳號與存取控制程序)**: 具體執行流程，關聯至 IC0201 與 IC0202。
- **IC0201 (帳號權限申請表)**: 執行過程需填寫的表單，依據 IP14 辦理。
- **IC0202 (存取權限審查表)**: 定期稽核需填寫的表單，依據 IC02/IP14 辦理。

## 5. 目前進度
- [x] 完成原始 Docx 轉換為 Markdown。
- [x] 完成 Markdown 檔案的結構化分段與語義關聯。
- [x] 完成多模態 PDF 預處理腳本 (圖片提取 + VLM 描述 + Markdown 回寫)。
- [ ] 待開發: 向量化儲存 (Vector Store) 與 LLM 檢索介面。